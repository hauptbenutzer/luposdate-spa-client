function createForceDirectedGraph(t,e){function n(t){var e=6*t.alpha;r.links.forEach(function(t){t.source.y-=e,t.target.y+=e}),_.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y}),u.attr("x1",function(t){return t.source.x}).attr("y1",function(t){return t.source.y}).attr("x2",function(t){return t.target.x}).attr("y2",function(t){return t.target.y}),d.attr("x",function(t){return t.x+11}).attr("y",function(t){return t.y+5})}var r=formatData(e);$(t+" svg").remove();var a=$(t).width()||400,i=$(t).height()||400,o=10,l=d3.scale.category20();r.nodes[0].fixed=1,r.nodes[0].x=a/2,r.nodes[0].y=50;var c=d3.layout.force().charge(-180).friction(.9).linkDistance(50).size([a,i]),s=d3.select(t).append("svg:svg").attr("width",a).attr("height",i),u=s.selectAll("line").data(r.links).enter().append("svg:line"),_=s.selectAll("circle").data(r.nodes).enter().append("svg:circle").attr("class","node").attr("data-text",function(t){return t.name||t.description}).attr("r",o-.75).style("fill",function(t){return l(t.group)}).style("stroke",function(t){return d3.rgb(l(t.group)).darker()}).call(c.drag),d=s.selectAll("text").data(r.nodes).enter().append("svg:text").attr("class","nodeText").attr("data-level",function(t){return t.level}).attr("data-id",function(t){return t.id}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).text(function(t){return t.name||t.description}).style("fill","#333").call(c.drag);c.nodes(r.nodes).links(r.links).on("tick",n).start()}function formatData(t){var e=t.optimization.steps[0].operatorGraph.nodes,n=t.optimization.steps[0].operatorGraph.edges,r=[];for(var a in n)if(n.hasOwnProperty(a)){var i=getIndexKey(a,n),o=getIndexValue(n[a][0],n);r.push({source:i,target:o,value:1})}return console.log(r),{nodes:e,links:r}}function getIndexKey(t,e){var n=0;for(var r in e){if(e.hasOwnProperty(r)&&e[r]==t)return n;n++}return console.log("ARGH1",t,e),!1}function getIndexValue(t,e){var n=0;for(var r in e)e.hasOwnProperty(r),n++;return console.log("ARGH2",t,e),!1}function createHorizontalTree(t){function e(t,n,r){if(t){n(t);var a=r(t);if(a)for(var i=a.length,o=0;i>o;o++)e(a[o],n,r)}}function n(){f.sort(function(t,e){return e.name.toLowerCase()<t.name.toLowerCase()?1:-1})}function r(){b.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}function a(t){scale=v.scale(),x=-t.y0,y=-t.x0,x=x*scale+_/2,y=y*scale+d/2,d3.select("g").transition().duration(u).attr("transform","translate("+x+","+y+")scale("+scale+")"),v.scale(scale),v.translate([x,y])}function i(t){var e=[1],n=function(t,r){r.children&&r.children.length>0&&(e.length<=t+1&&e.push(0),e[t+1]+=r.children.length,r.children.forEach(function(e){n(t+1,e)}))};n(0,o);var r=25*d3.max(e);f=f.size([r,_]);var a=f.nodes(o).reverse(),i=f.links(a);a.forEach(function(t){t.y=6*t.depth*c}),node=b.selectAll("g.node").data(a,function(t){return t.id||(t.id=++s)});var l=node.enter().append("g").call(dragListener).attr("class","node").attr("data-text",function(t){return t.name}).attr("transform",function(){return"translate("+t.y0+","+t.x0+")"});l.append("circle").attr("class","nodeCircle").attr("r",0).style("fill",function(t){return t._children?"lightsteelblue":"#fff"}),l.append("text").attr("x",function(t){return t.children||t._children?-10:10}).attr("dy",".35em").attr("class","nodeText").attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name.split("\n")[0]}).style("fill-opacity",0),node.select("text").attr("x",function(t){return t.children||t._children?-20:15}).attr("y",function(t){var e=t.children||t._children?5:0;return t.hasOwnProperty("x0")&&(e=0),e}).attr("text-anchor",function(t){return t.children||t._children?"end":"start"}).text(function(t){return t.name.split("\n")[0]}),node.select("circle.nodeCircle").attr("r",10).style("fill",function(t){return t._children?"lightsteelblue":"#fff"});var d=node.transition().duration(u).attr("transform",function(t){return"translate("+t.y+","+t.x+")"});d.select("text").style("fill-opacity",1);var h=node.exit().transition().duration(u).attr("transform",function(){return"translate("+t.y+","+t.x+")"}).remove();h.select("circle").attr("r",0),h.select("text").style("fill-opacity",0);var x=b.selectAll("path.link").data(i,function(t){return t.target.id});x.enter().insert("path","g").attr("class","link").attr("d",function(){var e={x:t.x0,y:t.y0};return p({source:e,target:e})}),x.transition().duration(u).attr("d",p),x.exit().transition().duration(u).attr("d",function(){var e={x:t.x,y:t.y};return p({source:e,target:e})}).remove(),a.forEach(function(t){t.x0=t.x,t.y0=t.y})}$("#luposgraph svg").hide(),console.log(t);var o,l=0,c=0,s=0,u=750,_=300,d=300,f=d3.layout.tree().size([h,w]),p=d3.svg.diagonal().projection(function(t){return[t.y,t.x]});e(t,function(t){l++;var e=t.name.split("\n")[0];c=Math.max(e.length,c)},function(t){return t.children&&t.children.length>0?t.children:null}),n();var v=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",r),g=d3.select("#luposgraph").append("svg").attr("id","luposgraph-horizontal-tree").attr("width",w).attr("height",h).attr("class","overlay").call(v);dragListener=d3.behavior.drag().on("dragstart",function(t){}).on("drag",function(t){return}).on("dragend",function(t){return});var b=g.append("g");o=t,o.x0=d/2,o.y0=0,i(o),a(o)}function createVerticalTree(t){function e(){l.attr("transform","translate("+d3.event.translate+") scale("+d3.event.scale+")")}function n(t){console.log("update",t);var e=i.nodes(root).reverse(),n=i.links(e);e.forEach(function(t){t.y=100*t.depth});var o=l.selectAll("g.node").data(e,function(t){return t.id||(t.id=++a)}),c=o.enter().append("g").attr("class","node").attr("transform",function(t){return"translate("+t.x+","+t.y+")"}).attr("data-text",function(t){return t.description});c.append("circle").attr("r",10).style("fill","#fff"),c.append("text").attr("y",function(t){return t.children||t._children?-18:18}).attr("dy",".35em").attr("text-anchor","middle").text(function(t){return t.description.split("\n")[0]}).style("fill-opacity",1);var s=l.selectAll("path.link").data(n,function(t){return t.target.id});s.enter().insert("path","g").attr("id",function(t){var e=t.source.id,n=t.target.id;return"path_"+e+"_"+n}).attr("class","link").attr("d",function(t){return"M "+t.source.x+" "+t.source.y+" L"+t.target.x+" "+t.target.y});var u=l.selectAll("text.linktext").data(n,function(t){return t.target.id});u.enter().insert("text","g").attr("class","linktext").attr("id",function(t){return console.log(t),"undefined"==typeof t.source.id?"label_"+t.source+"_"+t.target:"label_"+t.source.id+"_"+t.target.id}).attr("text-anchor","middle").style("text-anchor","middle").style("font-size","10px").style("fill","#888").append("textPath").attr("xlink:href",function(t){return"undefined"==typeof t.source.id?"#path_"+t.source+"_"+t.target:"#path_"+t.source.id+"_"+t.target.id}).attr("class","labelpath").attr("text-anchor","middle").style("text-anchor","middle").attr("startOffset","47%").text(function(t){return t.source.type+" --> "+t.target.type}),r()}function r(){scale=o.scale(),x=w/4,y=40,d3.select("g").transition().duration(1e3).attr("transform","translate("+x+","+y+")scale("+scale+")"),o.scale(scale),o.translate([x,y])}$("#luposgraph svg").remove(),h=500,w=800;var a=0,i=d3.layout.tree().size([h,w]),o=d3.behavior.zoom().scaleExtent([.1,3]).on("zoom",e),l=d3.select("#luposgraph").append("svg:svg").attr("id","luposgraph-vertical-tree").attr("width",w).attr("height",h).attr("pointer-events","all").call(o).append("svg:g").attr("class","hiho2");root=t.AST,n(root)}this.JST={query_picker:function(obj){obj||(obj={});{var __t,__p="";Array.prototype.join}with(obj)_.each(options,function(t){__p+='\n    <option value="'+(null==(__t=t)?"":__t)+'">\n        '+(null==(__t=App.baseName(t))?"":__t)+"\n    </option>\n"}),__p+="\n\n";return __p},results:function(obj){obj||(obj={});{var __t,__p="";Array.prototype.join}with(obj)__p+="<h4>Prefixes</h4>\n<table>\n    ",_.each(prefixes,function(t,e){__p+='\n        <tr>\n            <td class="sparql-prefix" style="color: '+(null==(__t=colors[e])?"":__t)+'">'+(null==(__t=e)?"":__t)+"</td>\n            <td>"+(null==(__t=t)?"":__t)+"</td>\n        </tr>\n    "}),__p+="\n</table>\n\n<h4>Results ("+(null==(__t=results.length)?"":__t)+')</h4>\n<table class="results">\n    <thead>\n        <tr>\n        ',_.each(variables,function(t){__p+="\n            <th>\n            "+(null==(__t=t)?"":__t)+"\n            </th>\n        "}),__p+="\n        </tr>\n    </thead>\n    <tbody>\n        ",_.each(results,function(t){__p+="\n            <tr>\n            "+(null==(__t=this.JST["results/result"]({binding:t.binding,prefixes:prefixes,colors:colors}))?"":__t)+"\n            </tr>\n        "}),__p+="\n    </tbody>\n</table>\n";return __p},spinner:function(obj){obj||(obj={});var __p="";with(obj)__p+="<h4>Waiting for Server..</h4>\n<div class='sk-spinner sk-spinner-cube-grid dark'>\n<div class='sk-cube'></div><div class='sk-cube'></div><div class='sk-cube'></div>\n<div class='sk-cube'></div><div class='sk-cube'></div><div class='sk-cube'></div>\n<div class='sk-cube'></div><div class='sk-cube'></div><div class='sk-cube'></div></div>";return __p},"results/boolean":function(obj){obj||(obj={});var __t,__p="";with(obj)__p+="<h4>Boolean</h4>\n<p>"+(null==(__t=boolean)?"":__t)+"</p>";return __p},"results/error":function(obj){obj||(obj={});var __t,__p="";with(obj)__p+='<h4><i class="fa fa-exclamation-triangle"></i> Error</h4>\n<p>The Server responded with:</p>\n<pre>\n'+(null==(__t=_.escape(msg))?"":__t)+"\n</pre>";return __p},"results/none":function(obj){obj||(obj={});var __t,__p="";with(obj)__p+="<h4>Server returned no identifiable results.</h4>\n<pre>\n"+(null==(__t=_.escape(plain))?"":__t)+"\n</pre>";return __p},"results/result":function(obj){obj||(obj={});{var __t,__p="";Array.prototype.join}with(obj)_.each(binding,function(t){__p+='\n    <td class="'+(null==(__t=t.type)?"":__t)+'">\n        ',"object"==typeof t?(__p+="\n\n            ","uri"in t&&(__p+="\n                ",__p+="prefix"in t?'\n                    <span class="sparql-prefix" style="color: '+(null==(__t=colors[t.prefix])?"":__t)+'">'+(null==(__t=t.prefix)?"":__t)+":</span>"+(null==(__t=t.uri)?"":__t)+"\n                ":"\n                    "+(null==(__t=t.uri)?"":__t)+"\n                ",__p+="\n            "),__p+="\n            ","literal"in t&&(__p+="\n                "+(null==(__t=t.literal)?"":__t)+"\n            "),__p+="\n            ","bnode"in t&&(__p+="\n                "+(null==(__t=t.bnode)?"":__t)+"\n            "),__p+="\n        "):__p+="\n            "+(null==(__t=t)?"":__t)+"\n        ",__p+="\n    </td>\n"}),__p+="\n";return __p}},function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../../bower_components/codemirror/lib/codemirror")):"function"==typeof define&&define.amd?define(["../../../bower_components/codemirror/lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("rif",function(t){function e(t){return new RegExp("^(?:"+t.join("|")+")$","i")}function n(t,e){var n=t.next();if(o=null,"$"==n||"?"==n)return t.match(/^[\w\d]*/),"variable-2";if("<"!=n||t.match(/^[\s\u00a0=]/,!1)){if('"'==n||"'"==n)return e.tokenize=r(n),e.tokenize(t,e);if("("==n&&t.eat("*"))return t.match(/.*\*\)/)?"comment":(t.skipToEnd(),"comment");if(/[{}\(\),\.;\[\]]/.test(n))return o=n,null;if(":"==n&&t.eat("-"))return"keyword";if("-"==n&&t.eat(">"))return"keyword";if("^"==n&&t.eat("^"))return"keyword";if(t.eatWhile(/[_\w\d]/),t.eat(":"))return t.eatWhile(/[\w\d_\-]/),"atom";var a=t.current();return c.test(a)?null:s.test(a)?"keyword":"variable"}return t.match(/^[^\s\u00a0>]*>?/),"atom"}function r(t){return function(e,r){for(var a,i=!1;null!=(a=e.next());){if(a==t&&!i){r.tokenize=n;break}i=!i&&"\\"==a}return"string"}}function a(t,e,n){t.context={prev:t.context,indent:t.indent,col:n,type:e}}function i(t){t.indent=t.context.indent,t.context=t.context.prev}var o,l=t.indentUnit,c=e(["str","lang","langmatches","datatype","bound","sameterm","isiri","isuri","isblank","isliteral","a"]),s=e(["document","prefix","group","forall","and","exists","external","or","##","#"]);return{startState:function(){return{tokenize:n,context:null,indent:0,col:0}},token:function(t,e){if(t.sol()&&(e.context&&null==e.context.align&&(e.context.align=!1),e.indent=t.indentation()),t.eatSpace())return null;var n=e.tokenize(t,e);if("comment"!=n&&e.context&&null==e.context.align&&"pattern"!=e.context.type&&(e.context.align=!0),"("==o)a(e,")",t.column());else if("["==o)a(e,"]",t.column());else if("{"==o)a(e,"}",t.column());else if(/[\]\}\)]/.test(o)){for(;e.context&&"pattern"==e.context.type;)i(e);e.context&&o==e.context.type&&i(e)}else"."==o&&e.context&&"pattern"==e.context.type?i(e):/atom|string|variable/.test(n)&&e.context&&(/[\}\]]/.test(e.context.type)?a(e,"pattern",t.column()):"pattern"!=e.context.type||e.context.align||(e.context.align=!0,e.context.col=t.column()));return n},indent:function(t,e){var n=e&&e.charAt(0),r=t.context;if(/[\]\}]/.test(n))for(;r&&"pattern"==r.type;)r=r.prev;var a=r&&n==r.type;return r?"pattern"==r.type?r.col:r.align?r.col+(a?0:1):r.indent+(a?0:l):0}}}),t.defineMIME("application/rif+xml","rif")}),function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../../bower_components/codemirror/lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";t.defineMode("n3",function(){function t(t,n){var r,a=t.location;r=a==e.PRE_SUBJECT&&"<"==n?e.WRITING_SUB_URI:a==e.PRE_SUBJECT&&"_"==n?e.WRITING_BNODE_URI:a==e.PRE_PRED&&"<"==n?e.WRITING_PRED_URI:a==e.PRE_OBJ&&"<"==n?e.WRITING_OBJ_URI:a==e.PRE_OBJ&&"_"==n?e.WRITING_OBJ_BNODE:a==e.PRE_OBJ&&'"'==n?e.WRITING_OBJ_LITERAL:"prefix"==n?e.PREFIX:a==e.PREFIX&&"prefixEnd"==n?e.POST_OBJ:a==e.WRITING_SUB_URI&&">"==n?e.PRE_PRED:a==e.WRITING_BNODE_URI&&" "==n?e.PRE_PRED:a==e.WRITING_PRED_URI&&">"==n?e.PRE_OBJ:a==e.WRITING_OBJ_URI&&">"==n?e.POST_OBJ:a==e.WRITING_OBJ_BNODE&&" "==n?e.POST_OBJ:a==e.WRITING_OBJ_LITERAL&&'"'==n?e.POST_OBJ:a==e.WRITING_LIT_LANG&&" "==n?e.POST_OBJ:a==e.WRITING_LIT_TYPE&&">"==n?e.POST_OBJ:a==e.WRITING_OBJ_LITERAL&&"@"==n?e.WRITING_LIT_LANG:a==e.WRITING_OBJ_LITERAL&&"^"==n?e.WRITING_LIT_TYPE:" "!=n||a!=e.PRE_SUBJECT&&a!=e.PRE_PRED&&a!=e.PRE_OBJ&&a!=e.POST_OBJ?a==e.POST_OBJ&&"."==n?e.PRE_SUBJECT:e.ERROR:a,t.location=r}var e={PRE_SUBJECT:0,WRITING_SUB_URI:1,WRITING_BNODE_URI:2,PRE_PRED:3,WRITING_PRED_URI:4,PRE_OBJ:5,WRITING_OBJ_URI:6,WRITING_OBJ_BNODE:7,WRITING_OBJ_LITERAL:8,WRITING_LIT_LANG:9,WRITING_LIT_TYPE:10,POST_OBJ:11,ERROR:12,PREFIX:13};return{startState:function(){return{location:e.PRE_SUBJECT,uris:[],anchors:[],bnodes:[],langs:[],types:[],prefixes:{}}},token:function(n,r){var a=n.next();if(r.location==e.PREFIX){var i="";return n.eatWhile(function(t){return":"!=t?(i+=t,!0):!1}),n.next(),r.prefixes[i]=i,t(r,"prefixEnd"),"def"}if("<"==a){t(r,a);var o="";return n.eatWhile(function(t){return"#"!=t&&">"!=t?(o+=t,!0):!1}),r.uris.push(o),n.match("#",!1)?"variable-3":(n.next(),t(r,">"),"variable-3")}if("#"==a){var l="";return n.eatWhile(function(t){return">"!=t&&" "!=t?(l+=t,!0):!1}),r.anchors.push(l),"variable-2"}if(">"==a)return t(r,">"),"variable-3";if("_"==a&&":"==n.peek()){t(r,a);var c="";return n.eatWhile(function(t){return" "!=t?(c+=t,!0):!1}),r.bnodes.push(c),n.next(),t(r," "),"string-2"}if('"'==a)return t(r,a),n.eatWhile(function(t){return'"'!=t}),n.next(),"@"!=n.peek()&&"^"!=n.peek()&&t(r,'"'),"string";if("@"==a){t(r,"@");var s="";return n.eatWhile(function(t){return" "!=t?(s+=t,!0):!1}),r.langs.push(s),"prefix"==s?t(r,"prefix"):t(r," "),"atom"}if("^"==a){n.next(),t(r,"^");var u="";return n.eatWhile(function(t){return">"!=t?(u+=t,!0):!1}),r.types.push(u),n.next(),t(r,">"),"attribute"}if(" "==a&&t(r,a),"."==a)return t(r,a),"operator";if(":"==a)return"tag";if(a.match(/[a-zA-Z]/)){var _=a;if(n.eatWhile(function(t){return t.match(/[a-zA-Z]/)?(_+=t,!0):!1}),_ in r.prefixes)return"def"}}}}),t.defineMIME("text/n-triples","n3")});