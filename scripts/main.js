var delay;this.App={isMergeView:!1},App.loadEditors=function(){return App.cm={},App.cm.sparql=CodeMirror.fromTextArea(document.getElementById("codemirror"),{mode:"sparql",lineNumbers:!0}),App.loadQuery("sparql",0),App.cm.rdf=CodeMirror.fromTextArea(document.getElementById("codemirror_rdf"),{lineNumbers:!0,mode:"n3"}),App.loadQuery("rdf",0),App.cm.rif=CodeMirror.fromTextArea(document.getElementById("codemirror_rif"),{lineNumbers:!0,mode:"rif"}),App.loadQuery("rif",0)},App.loadQuery=function(e,r){return $.ajax({url:App.config.defaultData[e][r],dataType:"text"}).done(function(r){return App.cm[e].getDoc().setValue(r)})},App.init=function(){return App.x2js=new X2JS({attributeArray:"_attributes"}),$.getJSON("scripts/config.json",function(e){return App.config=e,App.play()})},App.bindEvents=function(){return $(".query .evaluate").click(function(){var e,r;return App.cm.sparql.save(),r=""+App.config.endpoints[0].url+"sparql",e=$(this).parents(".query").find(".editor").val(),App.isMergeView&&$(".results-tab a").click(),$.ajax({url:r,method:"GET",data:{query:e},success:function(e){return App.processResults(e)}})}),$(document).foundation({tab:{callback:function(e){var r;return r=$(e.children("a").attr("href")),r.find(".CodeMirror").length?r.find(".CodeMirror")[0].CodeMirror.refresh():void 0}}}),$(".error-log button").click(function(){return $(this).next().toggleClass("visible")}),$(".query-select").change(function(){var e,r;return r=$(this).data("lang"),e=$(this).find("option:selected").index(),App.loadQuery(r,e)}),$(".fullscreen-toggle").click(function(){return $(".main-section").toggleClass("full")}),$(".right-side-toggle").click(function(){return $(".left-side .right-side-tab").length?($(".right-side-tab-content").appendTo($(".right-side .tabs-content")),$(".right-side-tab").appendTo($(".right-side .tabs")),$(".right-side").show(),$(".right-side .tabs a").get(0).click()):($(".right-side-tab-content").appendTo($(".left-side .tabs-content")),$(".right-side-tab").appendTo($(".left-side .tabs")),$(".right-side").hide()),$(this).toggleClass("active"),$(".left-side").toggleClass("medium-6 medium-12"),$(".left-side .tabs a").get(0).click(),App.isMergeView=!App.isMergeView})},App.play=function(){return App.loadEditors(),App.bindEvents(),App.insertQueryPicker(),pleaseWait.finish(),delay(1500,function(){return App.cm.sparql.refresh()})},App.insertQueryPicker=function(){var e;for(e in{sparql:"sparql",rdf:"rdf",rif:"rif"})$("#query-select-"+e).html(JST.query_picker({options:App.config.defaultData[e]}));return $("#rule_radios input[value="+App.config.defaultOntology+"]").click()},App.processResults=function(e){var r,t,i,n,s,o,a,l,p,u,d,c,f,g,m,A,h,b,y,x,v,q;if(!$.isXMLDoc(e))return App.logError("Endpoint answer was not valid XML.");i=App.x2js.xml2json(e);try{o={},t={},y=i.sparql._attributes;for(s in y)u=y[s],-1!==s.indexOf("xmlns:")&&(l=s.substr(s.indexOf("xmlns:")+6),o[l]=u,t[l]=randomColor({luminosity:"dark"}));for(c=[],x=i.sparql.head.variable,f=0,A=x.length;A>f;f++)d=x[f],c.push(d._attributes.name);for(v=i.sparql.results.result,g=0,h=v.length;h>g;g++)for(p=v[g],q=p.binding,m=0,b=q.length;b>m;m++){r=q[m];for(s in o)a=o[s],null!=r.uri&&-1!==r.uri.indexOf(a)&&(r.uri=r.uri.replace(a,""),r.prefix=s)}return $("#panel10").html(JST.results({results:i.sparql.results.result,prefixes:o,colors:t,variables:c}))}catch(k){return n=k,console.log(n.message),App.logError(n.message)}},App.logError=function(e){return $(".error-log .list").append("<li>"+e+"</li>")},App.baseName=function(e){var r;return r=new String(e).substring(e.lastIndexOf("/")+1),-1!==r.lastIndexOf(".")&&(r=r.substring(0,r.lastIndexOf("."))),r},delay=function(e,r){return setTimeout(r,e)},$(document).ready(function(){return App.init()});