"use strict";var delay;this.App={isMergeView:!1},App.init=function(){return App.x2js=new X2JS({attributeArray:"_attributes"}),App.URIQuery=URI(document.location.href).query(!0),$.getJSON("scripts/config.json").done(function(e){return App.config=e,App.URIQuery.config?$.getJSON(App.URIQuery.config).done(function(r){return App.config=$.extend(e,r,{}),App.play()}):App.play()})},App.play=function(){return App.loadEditors(),App.bindEvents(),App.initConfigComponents(),App.insertQueryPicker(),pleaseWait.finish(),delay(1500,function(){return App.cm.sparql.refresh()})},App.loadEditors=function(){return App.cm={},App.cm.sparql=CodeMirror.fromTextArea(document.getElementById("codemirror"),{mode:"sparql",lineNumbers:!0,matchBrackets:!0,autoCloseBrackets:!0}),App.loadQuery("sparql",0),App.cm.rdf=CodeMirror.fromTextArea(document.getElementById("codemirror_rdf"),{lineNumbers:!0,mode:"n3",matchBrackets:!0,autoCloseBrackets:!0}),App.loadQuery("rdf",0),App.cm.rif=CodeMirror.fromTextArea(document.getElementById("codemirror_rif"),{lineNumbers:!0,mode:"rif",matchBrackets:!0,autoCloseBrackets:!0}),App.loadQuery("rif",0)},App.loadQuery=function(e,r){var t;return t=$(".load-query-status[data-lang="+e),t.show().html('<i class="fa fa-spinner"></i>'),$.ajax({url:App.config.defaultData[e][r],dataType:"text"}).done(function(r){return t.html('<i class="fa fa-check-circle"></i>').fadeOut(500),App.cm[e].getDoc().setValue(r)})},App.bindEvents=function(){return $(".query .get-graph").click(function(){var e;return e={query:"SELECT * WHERE { ?s ?p ?o. } LIMIT 10"},$.ajax({url:"http://localhost:8080/nonstandard/sparql/info",method:"POST",data:JSON.stringify(e),success:function(e){return createVerticalTree(e)}})}),$(".query .evaluate").click(function(){var e,r,t,n,i,s,a,p;for(n in App.cm)App.cm[n].save();if(a=$(this).data("target"),r=App.config.endpoints[0],e={query:$(this).parents(".query").find(".editor").val()},r.nonstandard){t=r[a],e.rdf=App.config.sendRDF?App.cm.rdf.getValue():"",s=t[1],i=t[0],e.formats=["xml","plain"];for(n in App.config.queryParameters)e[n]=App.config.queryParameters[n];e=JSON.stringify(e)}else s="GET",i=r.without;return p=""+App.config.endpoints[0].url+i,App.isMergeView&&$(".results-tab a").click(),$("#results-tab").html(JST.spinner()),$.ajax({url:p,method:s,data:e,success:function(e){return App.processResults(e)}})}),$(document).foundation({tab:{callback:function(e){var r;return r=$(e.children("a").attr("href")),r.find(".CodeMirror").length?r.find(".CodeMirror")[0].CodeMirror.refresh():void 0}}}),$(".error-log button").click(function(){return $(this).next().toggleClass("visible")}),$(".query-select").change(function(){var e,r;return r=$(this).data("lang"),e=$(this).find("option:selected").index(),App.loadQuery(r,e)}),$(".fullscreen-toggle").click(function(){return $(".main-section").toggleClass("full"),$(this).toggleClass("active")}),$(".right-side-toggle").click(function(){return $(".left-side .right-side-tab").length?($(".right-side-tab-content").appendTo($(".right-side .tabs-content")),$(".right-side-tab").appendTo($(".right-side .tabs")),$(".right-side").show(),$(".right-side .tabs a").get(0).click()):($(".right-side-tab-content").appendTo($(".left-side .tabs-content")),$(".right-side-tab").appendTo($(".left-side .tabs")),$(".right-side").hide()),$(this).toggleClass("active"),$(".left-side").toggleClass("medium-6 medium-12"),$(".left-side .tabs a").get(0).click(),App.isMergeView=!App.isMergeView})},App.insertQueryPicker=function(){var e,r;r=[];for(e in{sparql:"sparql",rdf:"rdf",rif:"rif"})r.push($("#query-select-"+e).html(JST.query_picker({options:App.config.defaultData[e]})));return r},App.preprocessResults=function(e){var r,t;if(t=e,"triples"in e?r=App.processTriples(e.triples):"XML"in e&&(t=$.parseXML(e.XML[0]),null==t&&(r={sparql:{results:""}})),null==r&&$.isXMLDoc(t))r=App.x2js.xml2json(t);else if(null==r)return!1;return"Plain"in e&&(r.plain=e.Plain),r},App.processResults=function(e){var r,t,n,i,s,a,p,o,l,u,c,f,d,g,h,A,m,b,y,q;if(n=App.preprocessResults(e),n&&""!==n.sparql.results){c={},t={},d=n.sparql._attributes;for(p in d)b=d[p],-1!==p.indexOf("xmlns:")&&(f=p.substr(p.indexOf("xmlns:")+6),c[f]=b);c=$.extend(App.parseRDFPrefixes(App.cm.rdf.getValue()),c);for(p in c)b=c[p],t[p]=randomColor({luminosity:"dark"});if("boolean"in n.sparql)return $("#results-tab").html(JST["results/boolean"]({"boolean":n.sparql["boolean"]}));for(q=[],$.isArray(n.sparql.head.variable)||(n.sparql.head.variable=[n.sparql.head.variable]),g=n.sparql.head.variable,i=0,o=g.length;o>i;i++)y=g[i],q.push(y._attributes.name);for(h=n.sparql.results.result,s=0,l=h.length;l>s;s++)for(m=h[s],$.isArray(m.binding)||(m.binding=[m.binding]),A=m.binding,a=0,u=A.length;u>a;a++)r=A[a],App.replacePrefixes(r,c);return $("#results-tab").html(JST.results({results:n.sparql.results.result,prefixes:c,colors:t,variables:q}))}return n&&""===n.sparql.results?$("#results-tab").html(JST["results/none"]({plain:n.plain})):"queryError"in e?App.logError("Sparql: "+e.queryError.errorMessage,"sparql",e.queryError.line):"rdfError"in e?App.logError("RDF: "+e.rdfError.errorMessage,"rdf",e.rdfError.line):"rifError"in e?App.logError("RIF: "+e.rifError.errorMessage,"rif",e.rifError.line):App.logError("Endpoint answer was not valid.")},App.processTriples=function(e){var r,t,n,i,s,a,p,o,l,u,c,f;for(f=["subject","predicate","object"],r={sparql:{head:{variable:[]},results:{result:[]}}},t=0,s=f.length;s>t;t++)u=f[t],r.sparql.head.variable.push({_attributes:{name:u}});for(n=0,a=e.length;a>n;n++){for(l=e[n],o={binding:[]},i=0,p=f.length;p>i;i++)c=f[i],o.binding.push("uri"===l[c].type?{uri:l[c].value}:{literal:l[c].value});r.sparql.results.result.push(o)}return r},App.replacePrefixes=function(e,r){var t,n,i;if(null!=e.uri){for(n in r)i=r[n],-1!==e.uri.indexOf(i)&&(e.uri=e.uri.replace(i,""),e.prefix=n);return t=App.baseName(e.uri),e.uri=e.uri.replace(t,"<em>"+t+"</em>"),e.type="uri"}},App.parseRDFPrefixes=function(e){var r,t,n;for(n=/@prefix\s+([A-z0-9-]+):\s*<([^>]+)>\s+\./g,t={};r=n.exec(e);)t[r[1]]=r[2];return t},App.logError=function(e,r,t){return r&&t&&(t--,App.cm[r].setSelection({line:t,ch:0},{line:t,ch:80}),$("."+r+"-tab a").click()),$("#results-tab").html(JST["results/error"]({msg:e}))},App.baseName=function(e){var r;return r=new String(e).substring(e.lastIndexOf("/")+1),-1!==r.lastIndexOf(".")&&(r=r.substring(0,r.lastIndexOf("."))),r},App.configComponents={Radio:function(e,r,t){return $(e).change(function(){return t($(e).filter(":checked").val()),!0}),r?$(e).filter("[value="+r+"]").click():void 0},Check:function(e,r,t){return $(e).click(function(){return t($(e).is(":checked")),!0}),r?$(e).click():void 0}},App.initConfigComponents=function(){var e,r,t,n,i,s,a;for(i=App.config.hiddenTabs,e=0,t=i.length;t>e;e++)a=i[e],$("#"+a+"-tab").hide(),$("a[href=#"+a+"-tab]").parent("dd").hide();for(s=App.config.readOnlyTabs,r=0,n=s.length;n>r;r++)a=s[r],$("#"+a+"-tab, a[href=#"+a+"-tab]").addClass("read-only"),$("#"+a+"-tab").find("input, textarea, select").attr("readonly",!0);return App.configComponents.Radio("#rule_radios input",App.config.queryParameters.inference,function(e){return App.config.queryParameters.inference=e}),App.configComponents.Check("#send_rdf",App.config.defaultSendRDF,function(e){return App.config.sendRDF=e})},delay=function(e,r){return setTimeout(r,e)},$(document).ready(function(){return App.init()});